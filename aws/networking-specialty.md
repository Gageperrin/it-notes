# AWS Certified Advanced Networking Specialty

These are my notes for the AWS ANS-C00 exam. I have taken the content from [Adrian Cantrill's course](https://learn.cantrill.io/p/aws-certified-advanced-networking-specialty) for this exam, Tutorial Dojo's practice tests, and the official AWS documentation. 

These notes assume full and prior knowledge of requisite material for the Solutions Architect Associate and Professional exams and will only pre-requisite content in brief, if at all.

## Networking and Tech Fundamentals

### Networking Starter Pack

# Networking Starter Pack

The OSI Seven Layer Model of Networking:
1. Physical
2. Data Link
3. Network
4. Transport
5. Session
6. Presentation
7. Application

Media layers are 1-3, while host layers are 4-7.

#### 1 - Physical ####

Physical medium can be a copper wire (electrical), fibre (light), or WIFI (RF).

Layer 1 specfications define the transmission and reception of **raw bit streams** between a device and a shared physical medium. It define things like voltage levels, timing, rates, distances, modulation, and connectors.

A networking device called a hub can connect multiple devices. Anything received on any port is transmitted on every other port, including errors and collisions.

No device addressing, all data is processed by all devices. If multiple devices transmit at once, then a collision occurs. There are no media access control and no collision detection at this layer. Layer 1, in effect, scales very poorly.

Fibre use a thin glass or plastic core surrounded by protection to transmit data through light over the cable. It can cover larger distances at higher speeds than traditional copper wiring and it is more resistant to EMI or water ingress. 

The cable (jacket) influences distance, speed, and features while connectors influence what hardware the cable can be used with. Fibre is expressed as diameter of the core/diameter of the cladding (in microns), such as 9/125. The cladding is a boundary surrounding the core to contain the light. The buffer is a combination of internal coating and strenghtening fibres designed to absorb shock and provide strength to the core. The cable jacket surrounds the buffer.

Single-mode fibre allows one ray of light only, no bouncing or distortion. Best for longest distances with the highest bandwidth. Multi-mode by contrast allows for multiple rays of light at once which is better for speed at short distances but can cause distortion with distance. Single-mode usually has a yellow jacket, while multi-mode has orange or aqua colored jacket.

Fibre optic transceiver modules (SFP or MINI GBIC) generate or receives light from the fiber cable. The transceivers are also single-mode or multi-mode, optimized for the type of cable used. Common transceivers include 1000BASE-LX, 10GBASE-LR, and 100GBASE-LR4 (the types used in AWS Direct Connect).
#### 2 - Data Link ####

Devices at this layer have a unique hardware address (MAC address). It is 46 bits in hexidecimal, 24 bits for manufacturer. Frames are generated by the source device, and they can be addressed to a destination or broadcast.

Data link frame: Preamble of 56 bits & SFD 8 bits - Destination MAC address - Source MAC address - ET 16 bits - Payload (46-1500 bytes) -> FCS 32 bits.

Preamble -> MAC Header -> Payload

The payload is the data the frame carries from source to destination. It is generally provided by layer 3, and the EtherType (ET) attribute defines which Layer 3 protocol is used.

Layer 2 solves Layer 1 collision problems by controlling access to the physical medium through CSMA/CD. Process:
(1) Source device creates a Frame intending to send data to destination device.
(2) Source device checks carrier.
(3) If no carrier, then layer 1 takes the frame data, converts it to physical standard and transmits.
(4) Layer 1 on the destination device receives and passes frame to Layer 2 destination device.
(5) If destination device needs to send data, it builds a frame
(6) It detects a carrier, so it waits before transmitting.
(7) Once the first frame is finishing transmitting, it transmits the second frame.
(8) If collisions are detected (CD) both back off for a time and re-tried at a random time. Keeps re-trying with increased backup time if further collisions occur.

Layer 2 using a HUB is a weak solution because of collision and errors. It is better to use a Switch.

Switches understand frames and MAC addresses. They maintain a MAC address table which starts off as empty. As the switch received frames on its ports, it learns the connected devices and populates the MAC address table.

Switches store and forward frames. This means only valid frames are forwarded. Collisions are isolated on the port they occur. Every X port has X collision domains. It allows switches to scale.

#### 3 - Network ####

Two Local Area Networks need to be connected over a large distance. Layer 2 will not suffice for this communication. Ethernet is a Layer 2 protocol. Long distance point to point links will use more suitable protocols such as PPP/MPLS/ATM.

Internet Protocol (IP) is a Layer 3 protocol which adds cross-network IP addressing and routing to move data between Local Area Networks without direct P2P links. IP packets are moved step by step from source to destination via intermediate networks. Encapsulated in different frames along the way. Router devices (L3) remove frame encapsulation and add new frame encapsulation at every hop.

Source IP address and destination IP address included as well as Layer 4 protocol values. Similar to IPv6 packets with bigger source and destination IP addresses.

### IPv4 Addressing

133.33.3.7 is dotted decimal notation 4 values between 0 and 255. All IP Address have a network part (coming from the left). The host part is the remainder allotted from the right. If the network part of two IP addresses match, it means they are on the same IP network. If not, they are on different networks.

IP addresses are only represented in dotted decimal for humans. They are actually binary. Four sets of octets (8 bits). Total of 32 bits. 133.33.3.7 has a /16 prefix. 16 bits of the IP are the network, and the remaining bits are for the hosts. IP addresses are assigned by machine (DHCP) or humans.

### Subnets

Subnet masks are configured on Layer 3 interfaces. They allow a hsot to determine if an IP address is local or remote and whether it needs to use a gateway. A subnet mask is configured on a host device in addition to an IP address.

A subnet mask is a dotted decimal version of a binary number which indicates which part of an IP address is network (1) and which part is host (0). So a subnet mask of 255.255.0.0 designates the first two octets for the network (the 1's), and the last two octets for the host (the 0's).

133.33.3.7 IP address with a subnet of 255.255.0.0 has a network start of 133.33.0.0 and ends at 133.33.255.255.

### Route Tables and Routes

A source sends its IP packet on the default route 0.0.0.0/0 to the router. The router has multiple route tables to use for selection. The router compares the packet destination IP and route table for matching destinations. The more specific prefixes are preferred (0 is lowest, 32 is highest). 

Packet is forwarded on to the next hop or the target. (The higher the number after the slash, the more specific the prefix.) Packets are routed through sequential hops from source to the destination across the Internet.

### Address Resolution Protocol (ARP)

But how to find the MAC address for a given IP address? The Address Resolution Protocol.

Within a local network, data is moved via Layer 2 frames over Layer 1. ARP discovers which MAC relates to a given IP as the data is handed to the Layer 3 destination. ARP broadcasts on Layer 2 asking for a IP address. The destination IP address responds with the MAC address. The source device passes the frame using the destination MAC address obtained via ARP to Layer 1 for transmission.

Layer 1 on the destination device hands off the raw data to the frame on Layer 2. The destination MAC matches the address provided, so Layer 2 strips the frame and passes the payload to Layer 3. The packet matches the destination IP address, so the data is handed on to the destination.

### IP Routing

Outside of a local network. Subnet mask and desitnation IP show the destination IP is not local. It wraps it up in a frame. ARP is used to find the MAC address of the default gateway. The packet is given the router's IP and encapsulated in a frame. The destination is the router.

The router removes the frame around the packet and reviews packet IP destination. The router has a route for the network that the destination IP is in. It creates a new frame with a second router as the destination MAC. The packet is unchanged as it remains in the frame payload. The frame is sent to the sefcond router.

The second router removes the frame around the packet. The router confirms the destination IP is on the same network and uses ARP to get the MAC address of the destination. It creates a new frame with the destination MAC address and encapsulates the packet. The frame is sent to the destination device, the final destination.

### Summary

* IP Addresses add cross network addressing
* ARP
* Route
* Route Tables
* Router (encapsulates through Layer 2)
* Device to device over the Internet

#### 4 - Transport ####

Layer 3 has no method for channeling communications, and data can be sent out of order. Each packet is routed independently. Routing decisions are per packet. Per packet routing can have delays, and some packets can even be lost in transit.

Layer 4 consists of TCP (Transmission Control Protocol) and UDP traffic. TCP is slower and more reliable. UDP is faster but less reliable. 

### TCP

TCP segments are placed inside IP packets. Segments do not have source or destination IP addresses because the packets provide device addressing. 

The TCP header includes:
* A source and destination port. Ports allow for multiple streams of communication. 
* A sequence number for ordering and identfying segments in a connection.
* The acknowledgent field is the way that one side can indicate that it has received a segment in a sequence.
* Flags N' Things is another aspect used to close connection, synchronize sequence numbers, and reserve some space.
* The Window allows the receivers to control the rate at which the receiver receives the data. * * * Checksum is used for error checking and arrange for retransmission of the data.
* The urgent point marks latency-sensitive traffic. 

Alongside the header is the payload of data, all wrapped in the TCP segment.

TCP is connection based. A conneciton is established using a random port on a client and a known port on the server. The connection is bilateral.

Layer 4 divides data into segments linked to a connection with error checking, ordering, and retransmission not possible at Layer 3. 

A well known port like tcp/443 is used as a destination while an ephemeral port like tcp/23060 is used as a source. The connection is split between each direction. This is why there are two rules in NACL, one for outbound and one for response traffic.

TCP Well known ports:
* tcp/80 - HTTP & tcp/443 HTTPS
* tcp/22 - SSH
* tcp/25 - SMTP (email)
* tcp/21 - TELNET
* tcp/3389 Remote Desktop Protocol
* tcp/3306 MySQL/MariaDB/Aurora

TCP requires a three way handshake initiated through Flags. Flags can be set to alter the connection. `FIN` can be used to close, `ACK` for acknowledgements, and `SYN` to synchronize sequence numbers.

Send a segment with `SYN` sequence set from the client to the server ('cs'. `SYN-ACK` on server side will increment the sequence set. It picks a random sequence and sends the segment. It sends on a sequence of 'cs+1' and a sequence 'ss' back to the client. The client `ACK` increments both the sequence and the acknowledgement. Sends the acknowledgement back as a sequence 'cs+2' and the sequence back as an acknowledgement 'ss+1'. The connection is subsequently established and the client can send data.


#### 5 - Session ####

A stateless firewall does not understand the state of traffic. It needs two rules for both outbound and response traffic.

A stateful firewall sees one thing. Allowing the outbound implicity allows the inbound (e.g. AWS security group).

#### Extra - NAT ####

NAT is designed to overcome IPv4 shortages by adjusting packets of source and destination addresses to allow transit across different networks. NAT translates private IPv4 addresses to public ones.

A Static NAT device translates 1 private address to 1 fixed public address (IGW). A Dynamic NAT translates 1 private address to first available public address. Port Address Translation (PAT) translates many private addresses to 1 public address (NATGW).

Static NAT: The router maintains a NAT table, it maps PrivateIP : PublicIP (1:1). Packets are generated as normal with a private source IP and an external destination IP. If a Public IP has been allocated to the Private IP, the source address of the packet is translated as it passes through the NAT device.

Dynamic NAT: The router maintains a NAT table, it maps Private IP: Public IP in the same way as Static NAT, but the allocations are temporary. Multiple devices can use the same allocation over time if there is no overlap. In the public Internet, only one private IP will be mapped to the the public IP at any time, it is still 1:1 for the duration of the allocation. If the Public IP pool is exhausted then external access can fail.

PAT: The NAT Device records the source IP and source port. It replaces the source IP with the single public IP and a public source port allocated from a pool which allows IP overloading (many to one). Return traffic has the public IP of the NAT device and the destination port. Public port and Public IP are translated to Private port and Private IP. This is how AWS NAT Gateways work.

#### Subnetting ####

The IPv4 standard was standardized in 1981 through the RFC791 document. They occupy ranges between 0.0.0.0 and 255.255.255.255. This contains 4,294,967,296 IP addresses. It was originally managed by IANA but has since been delegated to regional authorities. All public IPv4 addresses are allocated, but there are private addresses that can be used freely.

It was historically divided into multiples classes such as class A (0.0.0.0 -> 127.255.255.255) with 128 networks for large networks and businesses. This has been largely handed over to regional authorities. Class B starts at 128.0.0.0 and ends at 191.255.255.255 and contains 16,384 for smaller businesses but this was also handed over to regional authorities. Class C (192.0.0.0 -> 223.255.255.255) with 2,097,152 networks for even smaller businesses. Class D (multi-cast) and Class E (reserved) were also set up.

IPv4 is now defined by the standard RFC1918. The first private range (10.0.0.0 - 10.255.255.255) contains 16,777,216 IP addresses. The next private range runs from 172.16.0.0 to 172.31.255.255 with 16 networks that contain 65,536 IPv4 addresses each. 192.168.0.0 - 192.168.255.255 is the third group with 256 networks with 256 IPv4 addresses each (used for home routing). It is best practice to never configure overlapping CIDR ranges.

A subnet is a prefix value `/` after the IPv4 address. For example, 10.16.0.0 starts at 10.16.0.0 and ends at 10.16.255.255. This can be sub-netted to create four smaller networks by splitting the network into two by making it `/17` with ranges 10.16.0.0/17 and 10.16.128.0/17. This second netowrk can then be split again `/18` into 10.16.128.0/18 and 10.16.192.0/18.


#### DDoS Attacks ####

DDoS are attacks designed to overload websites and compete against legitimate connections. They are often distributed so blocking individual IP ranges does not work. There are several types of attacks. Application Layer HTTP Floods push overwhelming traffic at Layer 7. Protocol attacks are SYN floods spoof a source IP address and initiate a connection attempt. The server tries to perform the handshake but is unable to locate the spoofed IP and so waits a specified duration to try to find it. Volumetric attacks rely on DNS amplification push a large amount of data to DNS server to overwhelm them with requests. Botnets are the machines that execute these attacks, usually installed as malware.

These attacks cannot be defended against using standard network protections.

#### SSL and TLS ####

Secure Sockets Layer (SSL) and Transport Layer Security (TLS) essentially do the same thing but TLS is newer. They provide privacy and data integrity between the client and server. They ensure that communications are encrypted. TLS starts with asymmetric encryption and then moves to symmetric encryption to save computation resources. TLS also provides server and client identity verification and ensures a reliable connection to prevent tampering.

There are three phases: cipher suites, authentication, and then key exchange. Cipher Suite is a group of algorithms for the communication process. The client and server need the same Cipher Suite available in order to communicate securely. This first phase is how they agree to communicate. 

In the second phase, the client validates the server certificate. The server should have a publicly trusted Certificate Authority signing their certificate. At this point, the client makes sure that the server certificate is both valid and matches DNS name. Then the client verifies the server has the private key.

In the third phase, the client provides an encrypted master key to the server which is then decrypted and used to generate a master secret. This master secret is used to generate symmetric session keys to encrypt and decrypt data.

#### DNS 101 ####

DNS is a discovery service that translates between IP addresses and domain names. A user will query a server for a domain name, the server will return the translated IP address either internally or via a DNS resolver server. The DNS record contains a zone file that matches the domain name to the IP. If the DNS resolver server does not have the record it will query a root DNS server. There are thirteen root servers in the world.

The DNS client is the client device. The resolver is the software that queries DNS. The zone is a part of the DNS database, and the zone file is a physical database for a zone. The nameserver is where zone files are hosted. Root hints are config points at the root server IP. a root server hosts the DNS root zone. The root zone points at TLD authoritative servers. gTLD is a generic top level domain like `.com` while ccTLD is a country-code top level domain like `.uk`.

Record types:
* `NS` name server records verify authority for domain hosts to host DNS records.
* `A` and `AAAA` records directly point to an IP. `AAAA` is for IPv6.
* `CNAME` records include DNS shortcuts and point to domain names, not IP addresses.
* `MX` records verify email servers and use priority values to determine authoritative mail domain.
* `TXT` records provide additional miscellaneous functionality such as proof of domain ownership for third parties.

#### VLANS, Trunks, and Q in Q ####

#### VLANS ####

A LAN is a shared broadcast domain that braodcasts to stations. This does not scale well with more stations added on. Each port is a separate collision domain which limits outages to one station. Physical LANs would divide departments into individual switches which are not connected and thus need their own broadcast domain. This limits inter-department communication especially if a staff member changes to another department but remains at the same desk.

Frame tagging (802.1Q & 802.1AD) introduces new standards in teh frame format by adding a new 32 bit payload for the VLAN ID (VLID). Tagging frames with a VLAN ID helps create separate virtual LANs in the same L2 physical network. They each have a separate broadcast domain and are isolated from all others. 

An issue could potentially arise if two different customers for a communications provider use the same VLAN ID such as 1337. The standard 802.1AD was introduced to resolve this by adding another 32 bit space in the frame for a customer tag (C-TAG) which is distinct from the service tag (S-TAG). A customer can divided their VLANs with S-TAGs while having their own C-TAG.

Q-in-Q allows ISPs to use VLANs across their network while carrying customer traffic which might also be using multiple VLANs.

`.1Q` switches set ports as either access ports or trunk ports. Access ports communicate with stations using normal ethernet (No VLAN tagging). When frames move through an access port to the switch, a VLAN ID is added. When a tagged frame enters an access port, any VLAN ID is removed. A trunk port is a connection between two 1Q-capable devices, usually two switches. The frame and VLAN ID are forwarded between trunk ports. Consequently, a tagged frame will only be sent to other access ports with the same VID or over a trunk port.

AWS Direct Connect uses VLANs, `.1Q` switches, and trunks.

#### Jumbo Frames and MTU ####

A jumbo frame is any frame beyond the maximum Ethernet V2 frame size of 1,500 bytes. Usually a jumbo frame refers to any frame under 9,000 bytes. All frames have a static frame overhead and then a dynamic frame payload. Jumbo frames have a 9,000 byte payload. Normal frames have a higher ratio of overhead to payload, and more space between frames which wastes time. Jumbo payloads pass more payload per frame overhead and it requires fewer frames which means less space between frames on the physical medium.

Jumbo frames are not supported outside a single VPC, over VPN connections, over an IGW, or over an inter-region VPC Peering Connection. Jumbo frames are supported with same-region VPC peering, Direct Connect, and TGW. (TGW can go up to 8,500 bytes). 
## VPCs - Advanced Functionality

### DHCP

The Dynamic Host Configuration Protocol (DHCP) provides an automatic configuration for network resources. It is a standard for passing configuration information to hosts on a TCP/IP network. The `options` field of a DHCP message contains configuration parameters including the domain name, DNS, and `netbios-node-typ`. It starts with L2 broadcast to get info the DHCP server.

AWS automatically creates a set of DHCP options alongside a VPC, which can be manually configured. Each VPC is provided two domain names, an `AmazonProvidedDNS` and a custom DNS domain.

DHCP Option Sets can be associated with 0 or more VPCs. Each VPC can only have up to 1 DHCP Option Set attached. DHCP Option Sets are immutable, once created. Associating a new option set is immediate but the implementation requires a DHCP Renew which takes time.
### VPC Router

Each VPC has an implicit router which is highly available across all AZs in a region. It is scalable and routes traffic between subnets, from external networks into the VPC, and from the VPC into external networks. The VPC router has an interface in every subnet, the `subnet+1` address (default via DHCP Option Set). It is controlled using route tables.

Every VPC is created with a main route table that is default for every subnet in the VPC. Custom route tables can be created and associated with subnets in the VPC, thus removing the main route table. Subnets can only be associated with one route table at a time.

The main route table should be left blank, changes to routing should be done via the custom route table.

### Stateful vs. Stateless Firewalls

TCP is a Layer 4 protocol that works on top of an IP address. Every connection has two parts: the request and the response. The client picks an ephemeral source port and initiates a connection with a known destination port. The server responds using a source port (e.g. `tcp/443`) and the ephemeral destination port picked by the client.

The source port, source IP, destination port, and destination IP uniquely identify the connection.

A request is outbound from the client perspective and inbound from the server perspective. The response outbound from the server perspective, and inbound from the client perspective.

Stateless firewalls require two rules for each state, One ingress and one egress rule for inbound connections, and then one egress and one ingress rule for outbound connections. Stateful firewalls only require one rule for a request or response. It will match ingress and egree traffic according to the session.

### Network Access Control Lists (NACL)

NACLs are an optional layer of VPC security that acts as a stateless firewall for controlling subnet traffic. They regulate subnet boundary traffic, not intra-subnet traffic. NACLs contain rules grouped into inbound and outbound. Inbound rules match traffic entering the subnet, outbound rules match traffic leaving the subnet. NACLs require one request and one response rule for any traffic within VPC, to a VPC, or from a VPC.

Rules match the destination IP/range, port and protocol and allow or deny based on that match. Rules are processed in order, lowest rule number first. Once a match occurs, processing stops. `*` is an implicit deny if nothing else matches (i.e. highest, last rule number).

Custom NACLs can be created and have no subnet association. They start with one inbound implicit deny and one outbound implicit deny. All traffic is denied unless otherwise specified.
### Security Groups

Security Groups are stateful and detect response traffic automatically. An allowed request entails an allowed response. There is no explicit deny, only allow or implicit deny. Specific bad actors cannot be blocked via security groups. Security groups support IP/CIDR and logical resources including other security groups and itself.

Security groups are fundamentally attached to ENI's, not instances. Logical referencing scales via self references, etc. IP changes are handled automatically. Security groups are much more adaptive and user-friendly than NACLs, but they do not block specific bad actors.

### VPC Flow Logs

VPC Flow Logs monitor traffic flow to and from interfaces within a VPC. It does not capture packet contents, only metadata. Third-party packet sniffer solutions would be needed to access packet contents.

VPC Flow Logs can be attached to all ENIs in a VPC, all ENIs in a subnet, or particular ENIs. Flow logs capture metadata from the capture point down. Flow Logs are not real-time. Log destinations include S3 (and query with Athena) or CloudWatch Logs. 

VPC Flow Log Syntax: `[version][account-id][interface-id][srcaddr][dstaddr][srcport][dstport][protocol][packets][bytes][start][end][action][log-status]`.

Action can be `ACCEPT` or `REJECT`.

Metadata servers are not recorded. This includes DHCP, Amazon DNS, and Amazon Windows license.

### AWS IPv6

Only public IPv4 addresses are routable over the public Internet. Private and public IPv4 and subnets are technically and architecturally distinct in AWS. NAT translates the private IPv4s to public. Services never have public IPv4 addressing in a VPC or EC2, only private addressing configuration. Public addresses are handled by the IGW.

All IPv6 addresses in AWS are publicly routable. NAT is not used with IPv6. Each VPC can be IPv6 enabled with a /56.

IPv4 and IPv6 routing are handled separately. IPv6 can be added while creating a VPC/Subnet or addressing can be migrated to IPv6. Can add VPC or subnet range as well as routes and appropriate gateways. Can configure IPv6 on services.

PrivateLink and Interface Endpoints do not support IPv6.
## VPC Public Networking

### IGW for IPv4 and IPv6

A VPC can have zero or one IGWs attached. A IGW can only be attached to one VPC at a time. IGWs are highly available and scalable by default. They work with both IPv4 and IPv6. IPv4 has static NAT while IPv6 routes IPv6 packets in and out of a VPC.

IGWs are used to attached either the AWS Public Zone or the Public Internet.

Egress-only IGWs can be used with IPv6 addresses to account for security issues with non-translated IPv6 addresses.
### BYoIP

AWS owns IPv4 and IPv6 addresses that are allocated to the users as needed, but they are not portable and cannot be used on-premises. AWS is authorized to own these IPs by Regional Internet Registries.

Users can port RIR-recognized IPv4 and IPv6 addresses into AWS and authorize AWS to BGP advertize from ASN 16509 and 14618. The Internet will then see these addresses within AWS.

To import an IP to AWS, the IP owner must create an RSA (AES256) private key and a X509 certificate signed by that key. The public key must be registered with the Resource Public Key Infrastructure of the local RIR. Requests are signed with the private key.

The owner creates and signs a Route Origin Authorization (ROA) to provide with AWS Public Space Network BGP ASN 16509 and 14618. A Route Origin Authorisation is a cryptographically signed object that states which Autonomous System is authorised to originate a certain prefix.

The owner needs to update the RDAP record for the address space with the appropriate RIR by adding the self-signed certificate. This verifies IP ownership. The owner creates an authorization message for AWS and signs with the private key. AWS uses the RDAP to verify IP ownership through the certificate stored in the RIR's RDAP system (with a command like `aws ec2 advertise-byoip-cidr --cidr address-range`). Once this is done AWS can run IP advertisements.

The most specific IPv4 address that can be imported is `/24`, for IPv6 it is `/48` for public CIDRs and `/56` for non-public CIDRs. IPs can only be imported one region at a time. Only five IPv4 and IPv6 address ranges can be used per region per account. IP address ranges cannot be shared with other accounts using AWS Resource Access Manager.

### Bastion Hosts

Bastion hosts sit in the public subnet to provide access to private resources ussing SSH or RDP. It is a server which runs at a network edge and is hardened to withstand attack from public networks. It is a gatekeeper between public and private zones.

A bastion is a subset of jumpbox in that it is hardened to attack. It is essentially an ingress control point with logging, authentication, and security.

Bastion hosts can be replaced by AWS SSM, but they are vendor neutral and still a popular option.

### NAT Instance

A NAT Instance is technically just an EC2 instance running NAT software. It runs NAT AMI Amazon Linux 2018.03 which is at end-of-life. It is not recommended to run NAT Instances.

They are non-specialized and their speed is based on the size and type of EC2 instance. It is necessary to disable source and destination checks to ensure packet delivery. Otherwise NAT will drop the packet. A NAT Instance can also act as a bastion host. It is self-managed and requires greater administrative overhead.

NAT Instance resilience and availability must be self-managed through scripts or other solutions for EC2 autoscaling and Route Table changes based on failures. It does allow the user to combine NAT, Bastion, and port forwards into a single instance. It can be attached to SG and NACL configurations and have VPC Flow Logs for monitoring. It also works across Direct Connect, VPN, and Peering Connections but this is not ideal for high-traffic NAT instances.

### NAT Gateway

A NAT Gateway is an AWS-managed NAT solution which allows private subnet resources to communicate with the Internet or other AWS services while keeping those private resources secure from external connections. A NAT Gateway has an allocated IPv4 public address that routes through the VPC Router to the IGW. The NAT Gateway private IP is mapped onto the public IP.

A route table for private instances points to the NAT Gateway which can then route requests to the IGW. NAT Gateways are AZ resilient but not region resilient. Full region resilience requires deploying a NATGW in each AZ with a route table for each AZ with each NATGW as its target. They have separate failure domains in an AZ. They are AWS-managed, scale up to 45 GB/s, and billing is based on duration and data volume. Full region resilience can become costly.

Other miscellaneous details. NAT Gateways are 5 GB/s by default and scale up to 45 GB/s. Split resources into multiple subnets and use multiple NATGWs for higher resilience and availability. An Elastic IP cannot be changed on a NATGW. A NAT Gateway can handle ~900 connections per second to a single destination. If this is exceeded, CloudWatch Logs will throw the error `ErrorPortAllocation` as no more ports are available for allocation. To avoid NAT Gateway usage costs, use Gateway Endpoints to access S3 or DynamoDB with zero data transfer costs. There are no security groups on a NAT Gateway.

## VPC Endpoints

### AWS PrivateLink

### Gateway VPC Endpoint

### Interface VPC Endpoint

## VPC Networking with EC2s

## Networking Automation

## Elastic Load Balancing

## Route 53 Networking

## CDN in AWS

## Networking Security, Risk, and Compliance

## VPC Peering

## VPC Hybrid Networking (Virtual)

## VPC Hybrid Networking (Physical)

## Hybrid Services

## Network Billing and Cost Management in Depth

## AWS Disaster Recovery